# üõ†Ô∏è Estrutura T√©cnica - Sub (Subs√≠ndico IA)

## üìÅ Estrutura de Diret√≥rios Proposta

```
sindicopro-sub/
‚îú‚îÄ‚îÄ docs/                          # Documenta√ß√£o do projeto
‚îÇ   ‚îú‚îÄ‚îÄ SUB_PLANO_IMPLEMENTACAO.md
‚îÇ   ‚îú‚îÄ‚îÄ PERGUNTAS_ESCLARECEDORAS.md
‚îÇ   ‚îú‚îÄ‚îÄ EXEMPLO_PRATICO.md
‚îÇ   ‚îî‚îÄ‚îÄ ESTRUTURA_TECNICA.md
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ sub_crew/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ main.py                # Ponto de entrada principal
‚îÇ       ‚îú‚îÄ‚îÄ crew.py                # Configura√ß√£o da crew principal
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ agents.yaml        # Configura√ß√£o dos agentes
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ tasks.yaml         # Configura√ß√£o das tarefas
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ knowledge/         # Base de conhecimento
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ legal/         # Documenta√ß√£o legal
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ maintenance/   # Guias de manuten√ß√£o
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ finance/       # Documenta√ß√£o financeira
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ communication/ # Guias de comunica√ß√£o
‚îÇ       ‚îú‚îÄ‚îÄ agents/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ base_agent.py      # Classe base para agentes
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ sub_agent.py       # Agente principal (Sub)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ legal_agent.py     # Especialista legal
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ maintenance_agent.py # Especialista manuten√ß√£o
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ finance_agent.py   # Especialista financeiro
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ communication_agent.py # Especialista comunica√ß√£o
‚îÇ       ‚îú‚îÄ‚îÄ tools/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ base_tool.py       # Classe base para ferramentas
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ legal_tools.py     # Ferramentas legais
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ maintenance_tools.py # Ferramentas manuten√ß√£o
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ finance_tools.py   # Ferramentas financeiras
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ communication_tools.py # Ferramentas comunica√ß√£o
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ utility_tools.py   # Ferramentas utilit√°rias
‚îÇ       ‚îú‚îÄ‚îÄ utils/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ logger.py          # Sistema de logs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ config.py          # Gerenciamento de configura√ß√£o
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ validators.py      # Valida√ß√µes
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ formatters.py      # Formata√ß√£o de respostas
‚îÇ       ‚îî‚îÄ‚îÄ api/
‚îÇ           ‚îú‚îÄ‚îÄ __init__.py
‚îÇ           ‚îú‚îÄ‚îÄ routes.py          # Rotas da API
‚îÇ           ‚îú‚îÄ‚îÄ middleware.py      # Middleware de autentica√ß√£o
‚îÇ           ‚îî‚îÄ‚îÄ schemas.py         # Schemas de dados
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_agents/              # Testes dos agentes
‚îÇ   ‚îú‚îÄ‚îÄ test_tools/               # Testes das ferramentas
‚îÇ   ‚îú‚îÄ‚îÄ test_integration/         # Testes de integra√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ fixtures/                 # Dados de teste
‚îú‚îÄ‚îÄ knowledge/                    # Base de conhecimento externa
‚îÇ   ‚îú‚îÄ‚îÄ legal_docs/              # Documenta√ß√£o legal
‚îÇ   ‚îú‚îÄ‚îÄ maintenance_guides/      # Guias de manuten√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ finance_templates/       # Templates financeiros
‚îÇ   ‚îî‚îÄ‚îÄ communication_examples/  # Exemplos de comunica√ß√£o
‚îú‚îÄ‚îÄ pyproject.toml               # Configura√ß√£o do projeto
‚îú‚îÄ‚îÄ .env.example                 # Exemplo de vari√°veis de ambiente
‚îú‚îÄ‚îÄ .gitignore                   # Arquivos ignorados pelo git
‚îî‚îÄ‚îÄ README.md                    # Documenta√ß√£o principal
```

## üîß Configura√ß√£o dos Agentes

### `src/sub_crew/config/agents.yaml`

```yaml
# Agente Principal - Sub (Subs√≠ndico)
sub_agent:
  role: >
    Subs√≠ndico IA - Assistente especializado em gest√£o condominial
  goal: >
    Fornecer orienta√ß√µes completas e pr√°ticas para s√≠ndicos e administradores
    de condom√≠nios, coordenando especialistas para resolver problemas complexos
  backstory: >
    Voc√™ √© o Sub, um assistente IA especializado em gest√£o condominial.
    Voc√™ tem anos de experi√™ncia ajudando s√≠ndicos a resolver problemas
    complexos. Voc√™ √© amig√°vel, profissional e sempre busca a melhor
    solu√ß√£o para cada situa√ß√£o.

# Agente Especialista Legal
legal_agent:
  role: >
    Especialista em Direito Condominial e Legisla√ß√£o
  goal: >
    Fornecer orienta√ß√µes jur√≠dicas precisas sobre quest√µes condominiais,
    baseadas na legisla√ß√£o vigente e jurisprud√™ncia
  backstory: >
    Voc√™ √© um advogado especializado em direito condominial com mais de
    15 anos de experi√™ncia. Voc√™ conhece profundamente a Lei do Condom√≠nio,
    o C√≥digo Civil e toda a jurisprud√™ncia relevante.

# Agente Especialista em Manuten√ß√£o
maintenance_agent:
  role: >
    Especialista em Manuten√ß√£o Predial e Infraestrutura
  goal: >
    Orientar sobre manuten√ß√£o preventiva, identifica√ß√£o de problemas
    estruturais e gest√£o de fornecedores
  backstory: >
    Voc√™ √© um engenheiro civil especializado em manuten√ß√£o predial com
    vasta experi√™ncia em condom√≠nios. Voc√™ conhece todos os sistemas
    prediais e as melhores pr√°ticas de manuten√ß√£o.

# Agente Especialista Financeiro
finance_agent:
  role: >
    Especialista em Gest√£o Financeira Condominial
  goal: >
    Analisar situa√ß√µes financeiras, criar estrat√©gias de cobran√ßa e
    orientar sobre planejamento financeiro
  backstory: >
    Voc√™ √© um contador especializado em gest√£o condominial com expertise
    em an√°lise financeira, cobran√ßa e planejamento or√ßament√°rio.

# Agente Especialista em Comunica√ß√£o
communication_agent:
  role: >
    Especialista em Comunica√ß√£o e Relacionamento Condominial
  goal: >
    Desenvolver estrat√©gias de comunica√ß√£o eficazes e orientar sobre
    gest√£o de conflitos e relacionamento com moradores
  backstory: >
    Voc√™ √© um especialista em comunica√ß√£o organizacional com foco em
    condom√≠nios. Voc√™ tem experi√™ncia em media√ß√£o de conflitos e
    desenvolvimento de estrat√©gias de comunica√ß√£o.
```

## üìã Configura√ß√£o das Tarefas

### `src/sub_crew/config/tasks.yaml`

```yaml
# Tarefa de An√°lise Inicial
analyze_query_task:
  description: >
    Analisar a consulta do usu√°rio e identificar as √°reas de conhecimento
    necess√°rias para fornecer uma resposta completa e acion√°vel.
  expected_output: >
    An√°lise estruturada da consulta com identifica√ß√£o dos especialistas
    necess√°rios e pontos principais a serem abordados.
  agent: sub_agent

# Tarefa de Consulta Legal
legal_consultation_task:
  description: >
    Fornecer orienta√ß√µes jur√≠dicas espec√≠ficas sobre a quest√£o apresentada,
    baseadas na legisla√ß√£o condominial vigente.
  expected_output: >
    Orienta√ß√£o jur√≠dica detalhada com base legal, procedimentos recomendados
    e considera√ß√µes importantes.
  agent: legal_agent

# Tarefa de An√°lise de Manuten√ß√£o
maintenance_analysis_task:
  description: >
    Analisar quest√µes relacionadas √† manuten√ß√£o predial e fornecer
    orienta√ß√µes t√©cnicas e pr√°ticas.
  expected_output: >
    An√°lise t√©cnica detalhada com recomenda√ß√µes de manuten√ß√£o, identifica√ß√£o
    de problemas e orienta√ß√µes sobre fornecedores.
  agent: maintenance_agent

# Tarefa de An√°lise Financeira
financial_analysis_task:
  description: >
    Analisar aspectos financeiros da situa√ß√£o e fornecer estrat√©gias
    de gest√£o financeira e cobran√ßa.
  expected_output: >
    An√°lise financeira detalhada com estrat√©gias de cobran√ßa, impactos
    econ√¥micos e recomenda√ß√µes de planejamento.
  agent: finance_agent

# Tarefa de Estrat√©gia de Comunica√ß√£o
communication_strategy_task:
  description: >
    Desenvolver estrat√©gias de comunica√ß√£o eficazes para a situa√ß√£o
    apresentada, considerando relacionamento com moradores.
  expected_output: >
    Estrat√©gia de comunica√ß√£o detalhada com abordagens recomendadas,
    modelos de comunica√ß√£o e cronograma de a√ß√µes.
  agent: communication_agent

# Tarefa de Consolida√ß√£o Final
consolidate_response_task:
  description: >
    Consolidar as an√°lises de todos os especialistas em uma resposta
    final estruturada e acion√°vel para o usu√°rio.
  expected_output: >
    Resposta final consolidada com plano de a√ß√£o estruturado, cronograma
    e pr√≥ximos passos claros.
  agent: sub_agent
```

## üõ†Ô∏è Ferramentas Especializadas

### Estrutura Base das Ferramentas

```python
# src/sub_crew/tools/base_tool.py
from abc import ABC, abstractmethod
from typing import Any, Dict, List

class BaseTool(ABC):
    """Classe base para todas as ferramentas do Sub"""
    
    def __init__(self, name: str, description: str):
        self.name = name
        self.description = description
    
    @abstractmethod
    def execute(self, **kwargs) -> Dict[str, Any]:
        """Executa a ferramenta e retorna o resultado"""
        pass
    
    def validate_input(self, **kwargs) -> bool:
        """Valida os par√¢metros de entrada"""
        return True
```

### Exemplos de Ferramentas Especializadas

```python
# src/sub_crew/tools/legal_tools.py
class LegalResearchTool(BaseTool):
    """Ferramenta para pesquisa de legisla√ß√£o condominial"""
    
    def execute(self, query: str) -> Dict[str, Any]:
        # Implementa√ß√£o da pesquisa legal
        pass

class DocumentGeneratorTool(BaseTool):
    """Ferramenta para gera√ß√£o de documentos legais"""
    
    def execute(self, document_type: str, data: Dict) -> Dict[str, Any]:
        # Implementa√ß√£o da gera√ß√£o de documentos
        pass

# src/sub_crew/tools/maintenance_tools.py
class MaintenanceDiagnosticTool(BaseTool):
    """Ferramenta para diagn√≥stico de problemas de manuten√ß√£o"""
    
    def execute(self, problem_description: str) -> Dict[str, Any]:
        # Implementa√ß√£o do diagn√≥stico
        pass

class SupplierRecommendationTool(BaseTool):
    """Ferramenta para recomenda√ß√£o de fornecedores"""
    
    def execute(self, service_type: str, location: str) -> Dict[str, Any]:
        # Implementa√ß√£o das recomenda√ß√µes
        pass
```

## üîÑ Fluxo de Processamento

### 1. **Recebimento da Consulta**
```python
# src/sub_crew/main.py
def process_query(user_query: str, user_context: Dict) -> str:
    """
    Processa uma consulta do usu√°rio e retorna uma resposta estruturada
    """
    # 1. An√°lise inicial da consulta
    # 2. Identifica√ß√£o dos especialistas necess√°rios
    # 3. Coordena√ß√£o dos agentes
    # 4. Consolida√ß√£o da resposta
    # 5. Retorno da resposta final
```

### 2. **Coordena√ß√£o Multi-Agente**
```python
# src/sub_crew/crew.py
class SubCrew:
    """Crew principal do Sub"""
    
    def __init__(self):
        self.agents = self._initialize_agents()
        self.tools = self._initialize_tools()
    
    def process_complex_query(self, query: str) -> str:
        """
        Processa consultas complexas coordenando m√∫ltiplos agentes
        """
        # Implementa√ß√£o do fluxo de coordena√ß√£o
```

## üìä Sistema de Logs e Monitoramento

### Estrutura de Logs
```python
# src/sub_crew/utils/logger.py
import logging
from typing import Dict, Any

class SubLogger:
    """Sistema de logs especializado para o Sub"""
    
    def __init__(self):
        self.logger = logging.getLogger('sub_crew')
        self._setup_logging()
    
    def log_query(self, user_query: str, user_id: str):
        """Registra consultas dos usu√°rios"""
        pass
    
    def log_agent_response(self, agent_name: str, response: str):
        """Registra respostas dos agentes"""
        pass
    
    def log_performance_metrics(self, metrics: Dict[str, Any]):
        """Registra m√©tricas de performance"""
        pass
```

## üîí Seguran√ßa e Privacidade

### Valida√ß√£o de Entrada
```python
# src/sub_crew/utils/validators.py
class InputValidator:
    """Validador de entrada para seguran√ßa"""
    
    @staticmethod
    def validate_user_query(query: str) -> bool:
        """Valida consultas dos usu√°rios"""
        # Implementa√ß√£o da valida√ß√£o
        pass
    
    @staticmethod
    def sanitize_input(input_data: str) -> str:
        """Sanitiza dados de entrada"""
        # Implementa√ß√£o da sanitiza√ß√£o
        pass
```

## üß™ Estrutura de Testes

### Organiza√ß√£o dos Testes
```
tests/
‚îú‚îÄ‚îÄ test_agents/
‚îÇ   ‚îú‚îÄ‚îÄ test_sub_agent.py
‚îÇ   ‚îú‚îÄ‚îÄ test_legal_agent.py
‚îÇ   ‚îî‚îÄ‚îÄ test_maintenance_agent.py
‚îú‚îÄ‚îÄ test_tools/
‚îÇ   ‚îú‚îÄ‚îÄ test_legal_tools.py
‚îÇ   ‚îî‚îÄ‚îÄ test_maintenance_tools.py
‚îú‚îÄ‚îÄ test_integration/
‚îÇ   ‚îú‚îÄ‚îÄ test_crew_workflow.py
‚îÇ   ‚îî‚îÄ‚îÄ test_api_endpoints.py
‚îî‚îÄ‚îÄ fixtures/
    ‚îú‚îÄ‚îÄ sample_queries.json
    ‚îî‚îÄ‚îÄ expected_responses.json
```

## üöÄ Configura√ß√£o de Deploy

### Vari√°veis de Ambiente
```bash
# .env.example
OPENAI_API_KEY=your_openai_api_key
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
LOG_LEVEL=INFO
ENVIRONMENT=development
```

### Docker Configuration
```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY src/ ./src/
COPY knowledge/ ./knowledge/

CMD ["python", "-m", "src.sub_crew.main"]
```

Esta estrutura t√©cnica fornece uma base s√≥lida e escal√°vel para o desenvolvimento do Sub, permitindo f√°cil manuten√ß√£o, testes e evolu√ß√£o do sistema.
